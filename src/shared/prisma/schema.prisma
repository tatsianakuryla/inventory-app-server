generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

enum Language {
  EN
  RU
}

enum Theme {
  LIGHT
  DARK
}

enum Status {
  BLOCKED
  ACTIVE
}

enum InventoryRole {
  OWNER
  VIEWER
  EDITOR
}

model User {
  id              String            @id @default(cuid())
  name            String
  email           String            @unique
  password        String?
  image           String?
  role            Role              @default(USER)
  status          Status            @default(ACTIVE)
  language        Language          @default(EN)
  theme           Theme             @default(LIGHT)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  version         Int               @default(1)
  googleId        String?           @unique
  facebookId      String?           @unique
  Inventory       Inventory[]
  InventoryAccess InventoryAccess[]

  @@index([id, version])
  @@index([name])
  @@index([role])
  @@index([status])
}

model Inventory {
  id          String   @id @default(cuid())
  name        String
  description String?
  ownerId     String
  owner       User     @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  version     Int      @default(1)

  access InventoryAccess[]

  @@index([ownerId])
  @@index([createdAt])
  @@index([id, version])
  @@index([name])
}

model InventoryAccess {
  id          String        @id @default(cuid())
  inventoryId String
  userId      String
  role        InventoryRole

  inventory Inventory @relation(fields: [inventoryId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([inventoryId, userId])
  @@index([userId])
  @@index([inventoryId, role])
}
